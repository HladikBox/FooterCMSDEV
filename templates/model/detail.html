{{include  file="$smarty_root/$CmsStyle/header.html" }}
<style>
.form-control[disabled], .form-control[readonly], fieldset[disabled] .form-control {
    background-color: white;
    opacity: 1;
	cursor: not-allowed; 
	border:0px;
}
.selectize-control .selectize-input.disabled{

    opacity: 1;
}
.selectize-input.disabled, .selectize-input.disabled * {
    opacity: 1;
	cursor: not-allowed; 
	border:0px;
}
.selectize-control.single .selectize-input.disabled:after {
	border-color:transparent  !important;
}
.selectize-input.disabled input, .selectize-input.disabled * {
	cursor: not-allowed; 
	color:#000000;
}
</style>
                <!-- content -->
                <div class="col-md-12" id="detailBody">
                    <div class="row  {{if $viewonly=='Y'}}hide{{/if}}" id="detailHeader">
                        <div class="col-lg-12">
                            <div class="page-header bootstrap-admin-content-title">
                                <h1 id="detailTitle">{{$ModelData.name}} {{if $action=="add"}}- {{if $incopy==1}}复制的{{/if}}{{$SysLang.model.add}}{{else}}{{/if}}</h1>                                
                                
                                        <button class="btn btn-primary" onclick='history.go(-1)'  ><i class="glyphicon  glyphicon-arrow-left glyphicon-white"></i> 后退</button>
                                {{foreach from=$ModelData.options.option item=rs}}                                
                                    {{if $rs.detail=="1"}}
                                        {{if $rs.type=="link"}}    
                                    <a href="{{$rs.function}}" class="action">
                                        <button {{if $rs.id!=""}}id="{{$rs.id}}"{{/if}} class="btn btn-success">{{$rs.name}}</button>
                                    </a>
                                        {{elseif $rs.type=="function"}}
                                    <a href="javascript:{{$rs.function}}" class="action btnfunc{{$rs.name}} " >
                                        <button {{if $rs.id!=""}}id="{{$rs.id}}"{{/if}} class="btn btn-success">{{$rs.name}}</button>
                                    </a>
                                        {{/if}}                                 
                                    {{/if}} 
                                {{/foreach}}
                            </div>
                        </div>
                    </div>

                    <div class="row" id="detailContent">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="bootstrap-admin-panel-content" style="padding-top:30px;">
                                    <div class="row form-horizontal" id="fieldContent">
									<input type="password" style="position:absolute; top:-999px" />
                                        {{foreach from=$ModelData.fields.field item=rs}}                                        
                                        {{if $rs.type=="text"  }}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}" {{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"  id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                {{if $rs.ismutillang=="1"}}
                                                {{foreach from=$SysLangConfig.langs.lang item=rslang}}
                                                <input type="{{if $rslang.code==$SysLangCode}}text{{else}}hidden{{/if}}" {{if $action!="add" and $rs.disableindetail=="1" }}disabled="disabled" {{/if}} class="form-control" value="{{foreach from=$rs.value item=rsval}}{{if $rslang.code==$rsval.code}}{{$rsval.value}}{{/if}}{{/foreach}}" id="content_{{$rs.key}}_{{$rslang.code}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} />
                                                {{/foreach}}
                                                <button {{if $action!="add" and $rs.disableindetail=="1" }}readonly="readonly" {{/if}} onclick="displayMutilLangPop('{{$rs.name}}','{{$rs.key}}')" class="btn btn-xs btn-link">{{$SysLang.model.updateotherlang}}</button>
                                                {{else}}
                                                <input type="text" {{if $action!="add" and $rs.disableindetail=="1"}}readonly="readonly"{{/if}} class="form-control" value="{{if $action=="add"}}{{$rs.default}}{{else}}{{$rs.value}}{{/if}}" id="content_{{$rs.key}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} />
                                                {{/if}}
												<span class='help-block'></span>
                                            </div>
                                        </div>                                            
                                        {{elseif $rs.type=="password"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <input type="password" class="form-control" value="{{$rs.value}}" id="content_{{$rs.key}}" {{if $rs.notnull=="1" }} placeholder="必填项" {{/if}} />
												<span class='help-block'></span>
                                            </div>
                                        </div>                
                                        {{elseif $rs.type=="longtext"}}
                                        <div class="form-group col-md-12 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-2 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-10">                                                
                                                {{if $rs.ismutillang=="1"}}
                                                {{foreach from=$SysLangConfig.langs.lang item=rslang}}
                                                <textarea rows="5" {{if $action!="add" and $rs.disableindetail=="1" }}readonly="readonly" {{/if}} class="form-control {{if $rslang.code!=$SysLangCode}}hide{{/if}}"  id="content_{{$rs.key}}_{{$rslang.code}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} >{{foreach from=$rs.value item=rsval}}{{if $rslang.code==$rsval.code}}{{$rsval.value}}{{/if}}{{/foreach}}</textarea>
                                                {{/foreach}}
                                                <button {{if $action!="add" and $rs.disableindetail=="1" }}readonly="readonly" {{/if}} onclick="displayMutilLangPop('{{$rs.name}}','{{$rs.key}}')" class="btn btn-xs btn-link">{{$SysLang.model.updateotherlang}}</button>
                                                {{else}}
                                                <textarea rows="5" class="form-control" {{if $action!="add" and $rs.disableindetail=="1" }}readonly="readonly" {{/if}} id="content_{{$rs.key}}"  {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} >{{if $action=="add"}}{{$rs.default}}{{else}}{{$rs.value}}{{/if}}</textarea>
                                                {{/if}}
												<span class='help-block'></span>
                                            </div>
                                        </div>                                            
                                        {{elseif $rs.type=="html"}}
										
										
                                        <div class="form-group col-md-12 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-2 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-10">
                                                <textarea {{if $action!="add" and $rs.disableindetail=="1" }}disabled="disabled" {{/if}}  id="content_{{$rs.key}}" class="ckeditor">{{$rs.value}}</textarea>
												<span class='help-block'></span>
                                            </div>
                                        </div>                                            
                                        {{elseif $rs.type=="datetime"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control datepicker" {{if $action!="add" and $rs.disableindetail=="1"}}disabled="disabled"{{/if}} id="content_{{$rs.key}}" value="{{if $action=="add"}}{{if $rs.default=='now'}}{{$now}}{{else}}{{$rs.default}}{{/if}}{{else}}{{$rs.value}}{{/if}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} />
												<span class='help-block'></span>
                                            </div>
                                        </div>                                            
                                        {{elseif $rs.type=="number"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-6">
                                                <input type="number" class="form-control col-md-9" {{if $action!="add" and $rs.disableindetail=="1"}} disabled="disabled" {{/if}} value="{{if $action=="add"}}{{if $rs.default==''}}{{$rs.minvalue+0}}{{else}}{{$rs.default+0}}{{/if}}{{else}}{{$rs.value}}{{/if}}" id="content_{{$rs.key}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} />
												<span class='help-block'></span>
                                            </div>
											<div class="col-md-2" style="margin-top:10px;">{{$rs.unit}}</div>
                                        </div>                                            
                                        {{elseif $rs.type=="check"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <input id="content_{{$rs.key}}" type="checkbox" {{if $action!="add" and $rs.disableindetail=="1"}}disabled="disabled"{{/if}}  {{if $rs.value=="Y"||($action=="add"&&$rs.default=="1")}}checked{{/if}} data-on-label="<i class='glyphicon glyphicon-ok glyphicon-white'></i>" data-offlabel="<i class='glyphicon glyphicon-remove'></i>" />
												<span class='help-block'></span>
                                            </div>
                                        </div>                                                      
                                        {{elseif $rs.type=="upload"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"  id="title_{{$rs.key}}" >{{$rs.name}}:</label>
                                            <div class="col-md-8">
												{{if ($action!="add" and $rs.disableindetail=="1")==false}}
                                                <input class="form-control uniform_on" name="file_{{$rs.key}}" id="file_{{$rs.key}}" onchange="upload('{{$rs.key}}', '{{$rs.uploadmodule}}')" type="file" />
												{{/if}}
                                                {{if $rs.filetype=="image"}}
                                                <br />
                                                <img id="view_{{$rs.key}}"  {{if $rs.value=="" }}style="display:none;height:100px;" {{else}}style="height:100px;" src="{{$uploadpath}}/{{$rs.uploadmodule}}/{{$rs.value}}"  onclick="openImgMap('view_{{$rs.key}}')" {{/if}} />
												{{elseif $rs.filetype=="audio"}}
                                                <br />
                                                <audio controls="controls" id="view_{{$rs.key}}" {{if $rs.value=="" }}style="display:none;" {{else}} src="{{$uploadpath}}/{{$rs.uploadmodule}}/{{$rs.value}}" {{/if}} />
												{{elseif $rs.filetype=="video"}}
                                                <br />
                                                <video controls="controls" id="view_{{$rs.key}}" {{if $rs.value=="" }}style="display:none;width:200px;" {{else}} style="width:200px" src="{{$uploadpath}}/{{$rs.uploadmodule}}/{{$rs.value}}" {{/if}} />
                                                {{else}}
                                                <a id="view_{{$rs.key}}" target="_blank" {{if $rs.value==""}}style="display:none;"{{else}}href="{{$uploadpath}}/{{$rs.uploadmodule}}/{{$rs.value}}"{{/if}} >{{$SysLang.model.viewupload}}</a>
                                                {{/if}}
                                                <input class="uniform_on" type="hidden" id="content_{{$rs.key}}" value="{{$rs.value}}" />
												<span class='help-block'></span>
                                            </div>
											<div class="col-md-4"></div>
											<div class="col-md-8">
											
											<a href="javascript:void();"; class="{{if $action=="add" or $rs.disableindetail=="1"}}hide{{/if}} deleteupload" name="{{$rs.key}}"  id="uploaddelete_{{$rs.key}}"  >删除</a>
											</div>
                                        </div>                                                             
                                        {{elseif $rs.type=="url"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"   id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <input type="text" {{if $action!="add" and $rs.disableindetail=="1"}}disabled="disabled"{{/if}} class="form-control" value="{{if $action=="add"}}{{$rs.defaultvalue}}{{else}}{{$rs.value}}{{/if}}" id="content_{{$rs.key}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" onchange="urlChange('{{$rs.key}}')" {{/if}} />
                                                {{if $rs.filetype=="image"}}
                                                <br />
                                                <img id="view_{{$rs.key}}" {{if $rs.value=="" }}style="display:none;height:100px;" {{else}}style="height:100px;" src="{{$rs.value}}" {{/if}} />
												{{elseif $rs.filetype=="audio"}}
                                                <br />
                                                <audio controls="controls" id="view_{{$rs.key}}" {{if $rs.value=="" }}style="display:none;" {{else}} src="{{$rs.value}}" {{/if}} />
												{{elseif $rs.filetype=="video"}}
                                                <br />
                                                <video controls="controls" id="view_{{$rs.key}}" {{if $rs.value=="" }}style="display:none;width:100%;" {{else}} stype="width:100%" src="{{$rs.value}}" {{/if}} />
                                                {{else}}
                                                <a id="view_{{$rs.key}}" target="_blank" {{if $rs.value==""}}style="display:none;"{{else}}href="{{$rs.value}}"{{/if}} >{{$SysLang.model.viewupload}}</a>
                                                {{/if}}
												<span class='help-block'></span>
                                            </div>
                                        </div>                                             
                                        {{elseif $rs.type=="fkey"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"  id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <select {{if $action!="add" and $rs.disableindetail=="1"}}disabled="disabled"{{/if}}  id="content_{{$rs.key}}" class="form-control selectize-select">
                                                    <option value="0">--{{$SysLang.model.select}}--</option>
                                                    {{foreach from=$rs.options item=rsoption}}
                                                    <option {{if $rs.value==$rsoption.id}}selected{{/if}} value="{{$rsoption.id}}">{{$rsoption.name}}</option>
                                                    {{/foreach}}
                                                </select>
												<a id="view_{{$rs.key}}" href="javascript:InfoDataShow('{{$userpath}}nomodule/{{$rs.viewmodel}}?action=view&id={{$rs.value}}')" class='{{if $rs.showview!="1"}}hide{{/if}}' >查看详情</a>
												<span class='help-block'></span>
                                            </div>
											
                                        </div>                                              
                                        {{elseif $rs.type=="flist"}}
                                        <div class="form-group col-md-12 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-2 control-label"  id="title_{{$rs.key}}">
                                            {{$rs.name}}
                                                <input class="uniform_on multicheckbox flist_all" type="checkbox" ref="flist_{{$rs.key}}" />
                                            </label>
                                            <div class="col-md-10">
                                                {{foreach from=$FListArr item=flrs}}
                                                {{if $rs.key==$flrs.key}}
                                                {{foreach from=$flrs.value item=rsvalue}}
                                                <div class="col-md-3 input_flist_{{$rs.key}}">
                                                    <input class='uniform_on multicheckbox flist_{{$rs.key}}' type='checkbox' id='flist_{{$rs.key}}_{{$rsvalue.id}}' value='{{$rsvalue.id}}'> {{$rsvalue.name}}
                                                </div>
                                                {{/foreach}}
                                                {{/if}}
                                                {{/foreach}}
                                                <input type="hidden" class="form-control"  id="content_{{$rs.key}}" value="{{$rs.value}}"  />
												<span class='help-block'></span>
                                            </div>
                                        </div>                            
                                        {{elseif $rs.type=="select"}}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}"{{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"  id="title_{{$rs.key}}" >{{$rs.name}}:</label>
                                            <div class="col-md-8">
                                                <select {{if $action!="add" and $rs.disableindetail=="1"}}disabled="disabled"{{/if}}  id="content_{{$rs.key}}" class="form-control selectize-select">
                                                    <option value="no-value">--{{$SysLang.model.select}}--</option>
                                                    {{foreach from=$rs.options.option item=rsoption}}
                                                <option {{if $rs.value==$rsoption.value or ($action=="add" and $rsoption.default=='1' )}}selected{{/if}} value="{{$rsoption.value}}">{{$rsoption.name}}</option>
                                                    {{/foreach}}
                                                </select>
												<span class='help-block'></span>
                                            </div>
                                        </div>                                           
                                        {{elseif $action!="add" and $rs.type=="grid"}}
                                        <div class="form-group col-md-12 {{if $rs.hidden==1}}hidden{{/if}}"  id="block_{{$rs.key}}">
                                            <label class="col-md-2 control-label"  id="title_{{$rs.key}}">{{$rs.name}}{{$SysLang.model.list}}</label>
                                            <div class="col-md-10">
												{{if ($action!="add" and $rs.disableindetail=="1")==false}}
                                                <button class="btn btn-primary btnGridAdd" onclick="window.location.href='{{$userpath}}nomodule/{{$rs.model}}?action=add&key={{$rs.modelkey}}&id={{$id}}&parenturl={{$request_url_encode}}';"><i class="glyphicon glyphicon-plus  glyphicon-white"></i> {{$SysLang.model.add}}{{$rs.name}}</button>
												{{/if}}
                                                <table class="table table-striped gridResult" id="content_{{$rs.key}}"></table>
                                            </div>
                                        </div>                                
                                        {{elseif $rs.type=="color"  }}
                                        <div class="form-group col-md-6 {{if $rs.hidden==1}}hidden{{/if}}" {{if $rs.description!=""}}data-toggle="tooltip" title="{{$rs.description}}" {{/if}} id="block_{{$rs.key}}">
                                            <label class="col-md-4 control-label"  id="title_{{$rs.key}}">{{$rs.name}}:</label>
                                            <div class="col-md-8">
												<div class="input-group color-picker">
                                                <input type="text" {{if $action!="add" and $rs.disableindetail=="1"}}readonly="readonly"{{/if}} class="form-control " value="{{if $action=="add"}}{{$rs.default}}{{else}}{{$rs.value}}{{/if}}" id="content_{{$rs.key}}" {{if $rs.notnull=="1" }} placeholder="{{$SysLang.model.required}}" {{/if}} />
												  <div class="input-group-addon">
													<i></i>
												  </div>
												 </div>
												<span class='help-block'></span>
                                            </div>
                                        </div>           
                                        {{/if}}
                                        {{/foreach}}
                                    </div>
                                    <hr />
                                    <div class="text-center" id="btnPanel" >
                                        <input type="hidden" id="content_id" value="{{$id}}" />
                                        {{if $ModelData.nosave!="1"}}
                                        <button class="btn btn-primary btnSave" onclick='save(1)' id='btnSave' ><i class="glyphicon  glyphicon-save glyphicon-white"></i> {{$SysLang.model.save}}</button>
											{{if $ModelData.nolist!='1'&&$parenturl==""}}
											<button class="btn btn-primary btnSave"  id='btnSaveNew' onclick='save(2)'><i class="glyphicon  glyphicon-file-plus  glyphicon-white"></i> 保存并新增</button>
											<button class="btn btn-primary btnSave"  id='btnSaveCopy' onclick='save(3)'><i class="glyphicon  glyphicon-clipboard  glyphicon-white"></i> 保存并复制</button>
											<button class="btn btn-primary" onclick='copynew()' id='btnCopy' ><i class="glyphicon glyphicon-copy  glyphicon-white"></i> 复制</button>
											{{/if}}
                                        {{/if}}
                                        {{if $parenturl!=""}}
                                        <button class="btn btn-primary" onclick="window.location.href='{{$parenturl}}';"><i class="glyphicon glyphicon-list  glyphicon-white"></i> {{$SysLang.model.back}}</button>
                                        {{elseif $ModelData.nolist!="1"}}<button class="btn btn-primary" id="btnReturnToList"><i class="glyphicon glyphicon-list  glyphicon-white"></i> {{$SysLang.model.backtolist}}</button>
                                        <button class="btn btn-primary" onclick='history.go(-1)'  ><i class="glyphicon  glyphicon-arrow-left glyphicon-white"></i> 后退</button>
                                        {{/if}}
										
										{{foreach from=$ModelData.options.option item=rs}}                                
											{{if $rs.detail=="1"}}
												{{if $rs.type=="link"}}    
											<a href="{{$rs.function}}" class="action">
												<button {{if $rs.id!=""}}id="{{$rs.id}}"{{/if}} class="btn btn-success">{{$rs.name}}</button>
											</a>
												{{elseif $rs.type=="function"}}
											<a href="javascript:{{$rs.function}}" class="action btnfunc{{$rs.name}} " >
												<button {{if $rs.id!=""}}id="{{$rs.id}}"{{/if}} class="btn btn-success">{{$rs.name}}</button>
											</a>
												{{/if}}                                 
											{{/if}} 
										{{/foreach}}
                                    </div>
                               </div>
                            </div>
                        </div>
                    </div>
                </div>

<link rel="stylesheet" type="text/css" href="{{$userpath}}myjs/{{$ModelData.model}}.css?now={{$now}}" />
<script type="text/javascript" src="{{$rootpath}}js/myjs.js"></script>
<script type="text/javascript" src="{{$userpath}}myjs/{{$ModelData.model}}.js"></script>
<script>
CKEDITOR.env.isCompatible = true;
    {{foreach from=$FListArr item=rs}}
    flistarr{{$rs.key}} = new Array();
    {{foreach from=$rs.value item=rsvalue}}
    flistarr{{$rs.key}}[{{$rsvalue.id}}] = "{{$rsvalue.name}}";
    {{/foreach}}
    {{/foreach}}

    $(function () {
        // CKEditor Full
		$('.color-picker').colorpicker();
        $('textarea.ckeditor').ckeditor({
            height: '200px',
            allowedContent: true,
            filebrowserBrowseUrl : '/vendors/ckeditor/ckfinder/ckfinder.html&g={{$LOGIN}}&m={{$ALIAS}}',
            filebrowserImageBrowseUrl : '/vendors/ckeditor/ckfinder/ckfinder.html?Type=Images&g={{$LOGIN}}&m={{$ALIAS}}',
            filebrowserFlashBrowseUrl : '/vendors/ckeditor/ckfinder/ckfinder.html?Type=Flash&g={{$LOGIN}}&m={{$ALIAS}}',
            filebrowserUploadUrl : '/vendors/ckeditor/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Files&g={{$LOGIN}}&m={{$ALIAS}}',
            filebrowserImageUploadUrl : '/vendors/ckeditor/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Images&g={{$LOGIN}}&m={{$ALIAS}}',
            filebrowserFlashUploadUrl : '/vendors/ckeditor/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Flash&g={{$LOGIN}}&m={{$ALIAS}}'
        });
        $(".flist_all").change(function(){
            var check=$(this).prop("checked");
            var fck=$(this).attr("ref");
            $("."+fck).prop("checked",check);
            if(check){
                $("."+fck).parent().addClass("checked");
            }else{
                $("."+fck).parent().removeClass("checked");
            }
        });
		
		$(".deleteupload").click(function(){
			var key=$(this).attr("name");
			//alert(key);
			$("#file_"+key).val("");
			$("#content_"+key).val("");
			$("#view_"+key).hide();
			 $(this).addClass("hide");
		});
        
        //$('#btnSave').click(save);
        $("#btnReturnToList").click(function(){
            self.location="{{$PageName}}";
        });
        {{foreach from=$ModelData.fields.field item=rs}}
        {{if $action!="add" and $rs.type=="grid"}}
        var json_{{$rs.key}}={"parenturl":"{{$request_url_encode}}"};
        $("#content_{{$rs.key}}").load("{{$userpath}}nomodule/{{$rs.model}}?action=getgrid&{{$rs.modelkey}}={{$id}}",json_{{$rs.key}},function(data){
			if(griddata_loaded!=undefined){
			griddata_loaded("{{$rs.key}}",data);
			}
        });
        {{elseif  $rs.type=="flist"}}
        var fliststr{{$rs.key}} = $("#content_{{$rs.key}}").val();
        var arr = fliststr{{$rs.key}}.split(",");
        for (var i = 0; i < arr.length; i++) {
            if ($.trim(arr[i]) != "") {
                $("#flist_{{$rs.key}}_" + $.trim(arr[i])).prop("checked", "checked");
            }
        }
        {{/if}}
        {{/foreach}}

            {{if $ParentKey!=""}}
            $("#content_{{$ParentKey}}").val({{$ParentId}});
            {{/if}}


    });

    function save(backtype){

        {{foreach from=$ModelData.fields.field item=rs}}
        {{if  $rs.type=="flist"}}
        var isfirst = true;
        var fliststr{{$rs.key}} ="";
        $(".flist_{{$rs.key}}:checked").each(function () {
            if (isfirst == false) {
                fliststr{{$rs.key}} = fliststr{{$rs.key}} + ",";
            }
            isfirst = false;
            fliststr{{$rs.key}} = fliststr{{$rs.key}} + $(this).val();
        });
        $("#content_{{$rs.key}}").val(fliststr{{$rs.key}});
        {{/if}}
        {{/foreach}}

            myjs_beforeSave();

        var isGo=saveValidate();
        if(isGo==false){
            return;
        }
        $(".btnSave").prop("disabled","disabled");
        var json={action:"save"
        ,"primary_id":"{{$id}}"
        {{foreach from=$ModelData.fields.field item=rs}}
        {{if $rs.type!="grid"}}
            {{if $rs.type=="check"}}
            ,"{{$rs.key}}":$("#content_{{$rs.key}}").prop("checked")?"Y":"N"
            {{elseif $rs.ismutillang=="1"}}
            {{foreach from=$SysLangConfig.langs.lang item=rslang}}
            ,"{{$rs.key}}_{{$rslang.code}}":$("#content_{{$rs.key}}_{{$rslang.code}}").val()
            {{/foreach}}
            {{else}}
            ,"{{$rs.key}}":$("#content_{{$rs.key}}").val()=="no-value"?"":$("#content_{{$rs.key}}").val()
            {{/if}}
        {{/if}}
        {{/foreach}}
        };
            json=myjs_saveClick(json);

            $.post("{{$PageName}}",json,function(data){
                
                $(".btnSave").prop("disabled","");
                if(myjs_aftersave(data)==false){
                    return;
                }
                if(data.substring(0,5)=="right"){
                    id=data.substring(5,data.length);
                    infoDialog("{{$SysLang.model.savesuccess}}");
					if(backtype==1){
						{{if $parenturl!=""}}
						self.location='{{$parenturl}}';
						{{elseif $action=="add"}}
						infoDialog("{{$SysLang.model.savesuccess}}。将于3秒后跳转到编辑。");
						setTimeout(function(){
							self.location='{{$PageName}}?action=edit&id='+id;
						},3000);
						{{/if}}
					}else if(backtype==2){
						infoDialog("{{$SysLang.model.savesuccess}}。将于3秒后跳转。");
						setTimeout(function(){
							self.location='{{$PageName}}?action=add';
						},3000);
					}else if(backtype==3){
						infoDialog("{{$SysLang.model.savesuccess}}。将于3秒后跳转。");
						setTimeout(function(){
							self.location='{{$PageName}}?action=add&copyid='+id;
						},3000);
					}
                }else{
                        errorDialog(data,"保存失败");
                }
        });

            
    }

    function urlChange(key){
		var val=$("#content_"+key).val();
		$("#view_"+key).attr("src",val).attr("href",val);
		if(val==""){
			$("#view_"+key).hide();
		}else{
			$("#view_"+key).show();
		}
		
	}
	
	function openImgMap(id){
		var src=$("#"+id).attr("src");
		window.open(src);
	}

    function saveValidate() {

        var message="";
        {{foreach from=$ModelData.fields.field item=rs}}
        {{if $rs.notnull=="1" }}
            {{if $rs.type=="fkey"}}
            if($("#content_{{$rs.key}}").val()=="0"){
                message+="<p>{{$SysLang.model.pleaseenter}}<span style='color:red;'>{{$rs.name}}</span></p>";
            }
            {{elseif $rs.ismutillang=="1"}}
            {{foreach from=$SysLangConfig.langs.lang item=rslang}}
            if($("#content_{{$rs.key}}_{{$rslang.code}}").val()==""){
                message+="<p>{{$SysLang.model.pleaseenter}}<span style='color:red;'>{{$rs.name}}（{{$rslang.name}}）</span></p>";
            }    
            {{/foreach}}
            {{else}}
            if($("#content_{{$rs.key}}").val()=="no-value"
                ||$("#content_{{$rs.key}}").val()==""){
                message+="<p>{{$SysLang.model.pleaseenter}}<span style='color:red;'>{{$rs.name}}</span></p>";
            }
            {{/if}}
        {{/if}}
        {{if $rs.type=="text"&&$rs.format!=""}}
            format_check={{$rs.format}};
            if(format_check.test($("#content_{{$rs.key}}").val())==false){
                message+="<p><span style='color:red;'>{{$rs.name}}</span>{{$SysLang.model.formatincorrect}}</p>";
            }
        {{/if}}

        {{if $rs.type=="number"&&$rs.minvalue!=""}}
            if(Number($("#content_{{$rs.key}}").val())<Number("{{$rs.minvalue}}")){
                message+="<p><span style='color:red;'>{{$rs.name}}</span>{{$SysLang.model.lessminvalue}}{{$rs.minvalue}}</p>";
            }
        {{/if}}
        {{if $rs.type=="number"&&$rs.maxvalue!=""}}
            if(Number($("#content_{{$rs.key}}").val())>Number("{{$rs.maxvalue}}")){
                message+="<p><span style='color:red;'>{{$rs.name}}</span>{{$SysLang.model.greatermaxvalue}}{{$rs.maxvalue}}</p>";
            }
        {{/if}}
        {{/foreach}}

       message+=myjs_savevalidate();

       if(message!=""){
           //infoDialog(message);
           infoDialog(message);
           return false;
       }
       return true;
    }

    
    function upload(key,module) {
        
        $.ajaxFileUpload
		(
			{
			    "url": '{{$userpath}}fileupload?module=' + module+"&field=file_" + key,
			    "secureuri": false,
			    "fileElementId": "file_" + key,
			    "dataType": 'text',
			    "success": function (data, status) {
			        if (data.substring(0, 7) == "success") {
			            str = data.substring(7, data.length);
			            $("#content_" + key).val(str.split('|~~|')[1]);

			            $("#view_" + key).attr("href", "{{$uploadpath}}/"+module+"/" + str.split('|~~|')[1])
                            .attr("src", "{{$uploadpath}}/"+module+"/" + str.split('|~~|')[1])
                            .show();
                        
						$("#uploaddelete_" + key).removeClass("hide");
						if(UploadedCallback!=undefined){
							UploadedCallback(key,module,"{{$uploadpath}}/"+module+"/" + str.split('|~~|')[1]);
						}
			        } else {
			            errorDialog("{{$SysLang.model.uploaderror}}");
			        }
			    },
			    "error": function (data, status, e) {
			        errorDialog("{{$SysLang.model.uploaderror}}");
			    }
			}
		);
    }
    function addNew(){
        self.location='{{$PageName}}?action=add';
    }
	function copynew(){
        self.location='{{$PageName}}?action=add&copyid='+primary_id;
	}

    function btnDeleteInList(){
           
            var isGo=deleteValidate();
            if(isGo==false){
                return;
            }

            confirmDialog("{{$SysLang.common.notice}}","{{$SysLang.model.deletesure}}",function(){
                    var idlist="{{$id}}";
                    if(idlist!="0"){
                        $.post("{{$PageName}}",{"action":"delete","idlist":idlist},function(data){
                            
                            if(myjs_afterdelete(data)==false){
                                return;
                            }

                            if(data=="success")
                            {
                                //
								{{if $parenturl!=""}}
								self.location='{{$parenturl}}';
								{{else}}
								window.location.href="{{$PageName}}";
								{{/if}}
                            }
                            else
                            {
                                errorDialog(data,"保存失败");
                            }
                
                        });
                    }
                });
        }
    function deleteValidate(){
        var message="";

        message+myjs_delevalidate();

        if(message!=""){
            //infoDialog(message);
            warningDialog(message);
            return false;
        }


        return true;

    }
	
	
    $(document).ready(function(){
        myjs_detailPageLoad();
    });
	
</script>

 {{include  file="$smarty_root/footer.html" }}